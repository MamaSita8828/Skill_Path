from aiogram import Router, F
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardRemove
from aiogram.types.input_file import FSInputFile
from aiogram.fsm.context import FSMContext
from utils.states import TestStates, RegistrationStates
from utils.scene_manager import scene_manager, SceneManager
from aiogram.filters import Command
from utils.messages import get_message, normalize_lang, get_user_lang, ARTIFACTS_BY_PROFESSION
from handlers.test_utils import start_test_flow
import json
from datetime import datetime
import random
from collections import defaultdict
from aiogram.utils.keyboard import InlineKeyboardBuilder
import asyncio
import re
from database import UserManager, TestProgressManager, TestResultsManager
from utils.artifacts import ARTIFACTS_BY_PROFESSION

router = Router()

PROFILE_DESCRIPTIONS = {
    '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å': {
        'ru': '–¢–µ–±—è –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤—Å—ë –Ω–µ–∏–∑–≤–µ–¥–∞–Ω–Ω–æ–µ, —Ç—ã –ª—é–±–∏—à—å –∏—Å–∫–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è. –¢—ã –Ω–µ –±–æ–∏—à—å—Å—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å.',
        'ky': '–°–µ–Ω–∏ –±–µ–ª–≥–∏—Å–∏–∑ –Ω–µ—Ä—Å–µ–ª–µ—Ä –∫—ã–∑—ã–∫—Ç—ã—Ä–∞—Ç, —Å–µ–Ω –∂–∞“£—ã —ã–∫–º–∞–ª–∞—Ä–¥—ã –∏–∑–¥–µ–ø, –∂–∞“£—ã –±–∏–ª–∏–º–¥–µ—Ä–¥–∏ –∞—á–∫–∞–Ω–¥—ã –∂–∞–∫—Ç—ã—Ä–∞—Å—ã“£. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—Ç–µ–Ω –∫–æ—Ä–∫–ø–æ–π—Å—É“£.'
    },
    '–ê–Ω–∞–ª–∏—Ç–∏–∫': {
        'ru': '–¢—ã –ª—é–±–∏—à—å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–∞—Ö–æ–¥–∏—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏. –¢–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –¥–µ–ª–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã.',
        'ky': '–ú–∞–∞–ª—ã–º–∞—Ç—Ç–∞—Ä–¥—ã —Ç–∞–ª–¥–æ–æ–Ω—É, –º—ã–π–∑–∞–º —á–µ–Ω–µ–º–¥“Ø“Ø–ª“Ø–∫—Ç”©—Ä–¥“Ø —Ç–∞–±—É—É–Ω—É –∂–∞–Ω–∞ —Ç–∞—Ç–∞–∞–ª –º–∞—Å–µ–ª–µ–ª–µ—Ä–¥–∏ —á–µ—á“Ø“Ø–Ω“Ø –∂–∞–∫—Ç—ã—Ä–∞—Å—ã“£. –ú–∞–∞–ª—ã–º–∞—Ç –º–µ–Ω–µ–Ω –∏—à—Ç–µ–ø, –ª–æ–≥–∏–∫–∞–ª—ã–∫ —Ç—ã—è–Ω–∞–∫—Ç–∞—Ä–¥—ã —á—ã–≥–∞—Ä—É—É —Å–∞–≥–∞ –∂–∞–≥–∞—Ç.'
    },
    '–¢–≤–æ—Ä–µ—Ü': {
        'ru': '–£ —Ç–µ–±—è –±–æ–≥–∞—Ç–æ–µ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ. –¢—ã —É–º–µ–µ—à—å –≤–∏–¥–µ—Ç—å –∫—Ä–∞—Å–æ—Ç—É –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ.',
        'ky': '–°–µ–Ω–∏–Ω –±–∞–π –∫—ã—è–ª—ã“£ –∂–∞–Ω–∞ ”©–∑–≥”©—á”© –æ–π –∂“Ø–≥“Ø—Ä—Ç“Ø“Ø“£ –±–∞—Ä. –°–µ–Ω —Å—É–ª—É—É–ª—É–∫—Ç—É –∫”©—Ä”© –±–∏–ª–µ—Å–∏“£ –∂–∞–Ω–∞ –∂–∞“£—ã –Ω–µ—Ä—Å–µ–ª–µ—Ä–¥–∏ –∂–∞—Ä–∞—Ç–∞ –∞–ª–∞—Å—ã“£.'
    },
    '–¢–µ—Ö–Ω–∞—Ä—å': {
        'ru': '–¢—ã —É–≤–ª–µ–∫–∞–µ—à—å—Å—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏, –ª—é–±–∏—à—å —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–≤–æ–∏–º–∏ —Ä—É–∫–∞–º–∏.',
        'ky': '–°–µ–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª–∞—Ä–≥–∞ –∫—ã–∑—ã–≥–∞—Å—ã“£, —Ç“Ø–∑“Ø–ª“Ø—à—Ç”©—Ä–¥“Ø–Ω –∏—á–∏–Ω —Ç“Ø—à“Ø–Ω–≥”©–Ω–¥“Ø –∂–∞–Ω–∞ ”©–∑ –∫–æ–ª—É“£ –º–µ–Ω–µ–Ω –±–∏—Ä –Ω–µ—Ä—Å–µ –∂–∞—Å–∞–≥–∞–Ω–¥—ã –∂–∞–∫—Ç—ã—Ä–∞—Å—ã“£.'
    },
    '–ö–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä': {
        'ru': '–¢—ã –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—à—å –æ–±—â–∏–π —è–∑—ã–∫ —Å –ª—é–¥—å–º–∏, —É–º–µ–µ—à—å —Å–ª—É—à–∞—Ç—å –∏ –¥–æ–Ω–æ—Å–∏—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏.',
        'ky': '–°–µ–Ω –∞–¥–∞–º–¥–∞—Ä –º–µ–Ω–µ–Ω —Ç–∏–ª —Ç–∞–±—ã—à—É—É–¥–∞ –∂–µ“£–∏–ª, —É–≥—É–ø –∂–∞–Ω–∞ –æ–π–ª–æ—Ä—É“£–¥—É –∂–µ—Ç–∫–∏—Ä–µ –±–∏–ª–µ—Å–∏“£.'
    },
    '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä': {
        'ru': '–¢—ã —É–º–µ–µ—à—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–¥–∞—á–∏ –∏ –≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É –∫ —Ü–µ–ª–∏.',
        'ky': '–°–µ–Ω –ø–ª–∞–Ω–¥–∞—à—Ç—ã—Ä—ã–ø, —Ç–∞–ø—à—ã—Ä–º–∞–ª–∞—Ä–¥—ã –±”©–ª“Ø—à—Ç“Ø—Ä“Ø–ø, –∫–æ–º–∞–Ω–¥–∞–Ω—ã –º–∞–∫—Å–∞—Ç–∫–∞ –∂–µ—Ç–∫–∏—Ä–µ –∞–ª–∞—Å—ã“£.'
    },
    '–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ö—É–¥–æ–∂–Ω–∏–∫': {
        'ru': '–¢—ã –≤–∏–¥–∏—à—å –º–∏—Ä —á–µ—Ä–µ–∑ –ø—Ä–∏–∑–º—É —Ü–≤–µ—Ç–∞ –∏ —Ñ–æ—Ä–º—ã, —É–º–µ–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã.',
        'ky': '–°–µ–Ω –¥“Ø–π–Ω”©–Ω“Ø —Ç“Ø—Å –∂–∞–Ω–∞ —Ñ–æ—Ä–º–∞ –∞—Ä–∫—ã–ª—É—É –∫”©—Ä”©—Å“Ø“£, –≤–∏–∑—É–∞–ª–¥—ã–∫ –æ–±—Ä–∞–∑–¥–∞—Ä–¥—ã –∂–∞—Ä–∞—Ç–∞ –∞–ª–∞—Å—ã“£.'
    },
    '–¶–∏—Ñ—Ä–æ–≤–æ–π —Ö—É–¥–æ–∂–Ω–∏–∫': {
        'ru': '–¢—ã —Ç–≤–æ—Ä–∏—à—å –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å—Ä–µ–¥–µ, —Å–æ–∑–¥–∞—ë—à—å –≥—Ä–∞—Ñ–∏–∫—É, –∞–Ω–∏–º–∞—Ü–∏—é –∏–ª–∏ –¥–∏–∑–∞–π–Ω.',
        'ky': '–°–µ–Ω —Å–∞–Ω–∞—Ä–∏–ø —á”©–π—Ä”©–¥”© –∂–∞—Ä–∞—Ç–∞—Å—ã“£, –≥—Ä–∞—Ñ–∏–∫–∞, –∞–Ω–∏–º–∞—Ü–∏—è –∂–µ –¥–∏–∑–∞–π–Ω —Ç“Ø–∑”©—Å“Ø“£.'
    },
    '–ü–∏—Å–∞—Ç–µ–ª—å': {
        'ru': '–¢—ã —É–º–µ–µ—à—å –≤—ã—Ä–∞–∂–∞—Ç—å –º—ã—Å–ª–∏ —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã –∏ –∏—Å—Ç–æ—Ä–∏–∏.',
        'ky': '–°–µ–Ω –æ–π–ª–æ—Ä—É“£–¥—É —Å”©–∑–¥”©—Ä –∞—Ä–∫—ã–ª—É—É –±–∏–ª–¥–∏—Ä–∏–ø, —Ç–µ–∫—Å—Ç—Ç–µ—Ä–¥–∏ –∂–∞–Ω–∞ –æ–∫—É—è–ª–∞—Ä–¥—ã –∂–∞—Ä–∞—Ç–∞ –∞–ª–∞—Å—ã“£.'
    },
    '–≠–∫–æ–ª–æ–≥': {
        'ru': '–¢—ã –∑–∞–±–æ—Ç–∏—à—å—Å—è –æ –ø—Ä–∏—Ä–æ–¥–µ –∏ —Å—Ç—Ä–µ–º–∏—à—å—Å—è —Å–¥–µ–ª–∞—Ç—å –º–∏—Ä —á–∏—â–µ –∏ –ª—É—á—à–µ.',
        'ky': '–°–µ–Ω –∂–∞—Ä–∞—Ç—ã–ª—ã—à—Ç—ã –∫–æ—Ä–≥–æ–π—Å—É“£ –∂–∞–Ω–∞ –¥“Ø–π–Ω”©–Ω“Ø —Ç–∞–∑–∞—Ä–∞–∞–∫ –∂–∞–Ω–∞ –∂–∞–∫—à—ã—Ä–∞–∞–∫ –∫—ã–ª—É—É–≥–∞ —É–º—Ç—É–ª–∞—Å—ã“£.'
    },
    '–£—á–µ–Ω—ã–π-–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫': {
        'ru': '–¢—ã –ª—é–±–∏—à—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞–∫–æ–Ω—ã –ø—Ä–∏—Ä–æ–¥—ã –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã.',
        'ky': '–°–µ–Ω —Ç–∞–±–∏—è—Ç –º—ã–π–∑–∞–º–¥–∞—Ä—ã–Ω –∏–∑–∏–ª–¥–µ–ø, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—Ç–µ—Ä–¥–∏ –∂“Ø—Ä–≥“Ø–∑–≥”©–Ω–¥“Ø –∂–∞–∫—Ç—ã—Ä–∞—Å—ã“£.'
    },
    '–°–æ—Ü–∏–æ–ª–æ–≥': {
        'ru': '–¢–µ–±–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ –æ–±—â–µ—Å—Ç–≤–æ –∏ –∫–∞–∫ –ª—é–¥–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç.',
        'ky': '–°–∞–≥–∞ –∫–æ–æ–º–¥—É–Ω —Ç“Ø–∑“Ø–ª“Ø—à“Ø –∂–∞–Ω–∞ –∞–¥–∞–º–¥–∞—Ä–¥—ã–Ω ”©–∑ –∞—Ä–∞ –º–∞–º–∏–ª–µ—Å–∏ –∫—ã–∑—ã–∫—Ç—É—É.'
    },
    '–ò—Å—Ç–æ—Ä–∏–∫': {
        'ru': '–¢—ã –ª—é–±–∏—à—å –∏–∑—É—á–∞—Ç—å –ø—Ä–æ—à–ª–æ–µ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏.',
        'ky': '–°–µ–Ω ”©—Ç–∫”©–Ω –º–µ–∑–≥–∏–ª–¥–∏ –∏–∑–∏–ª–¥–µ–ø, —Ç–∞—Ä—ã—Ö—Ç–∞–≥—ã –º—ã–π–∑–∞–º —á–µ–Ω–µ–º–¥“Ø“Ø–ª“Ø–∫—Ç”©—Ä–¥“Ø —Ç–∞–±—É—É–Ω—É –∂–∞–∫—Ç—ã—Ä–∞—Å—ã“£.'
    },
    '–ü—Å–∏—Ö–æ–ª–æ–≥': {
        'ru': '–¢—ã —Ä–∞–∑–±–∏—Ä–∞–µ—à—å—Å—è –≤ –ª—é–¥—è—Ö –∏ –∏—Ö –º–æ—Ç–∏–≤–∞—Ö, —É–º–µ–µ—à—å —Å–ª—É—à–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.',
        'ky': '–°–µ–Ω –∞–¥–∞–º–¥–∞—Ä–¥—ã –∂–∞–Ω–∞ –∞–ª–∞—Ä–¥—ã–Ω –º–æ—Ç–∏–≤–¥–µ—Ä–∏–Ω —Ç“Ø—à“Ø–Ω”©—Å“Ø“£, —É–≥—É–ø –∂–∞–Ω–∞ –∫–æ–ª–¥–æ–π –∞–ª–∞—Å—ã“£.'
    },
    '–ò–Ω–∂–µ–Ω–µ—Ä-—Å–∏—Å—Ç–µ–º–æ—Ç–µ—Ö–Ω–∏–∫': {
        'ru': '–¢—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—à—å —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –¥–µ–ª–∞–µ—à—å –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏.',
        'ky': '–°–µ–Ω —Ç–∞—Ç–∞–∞–ª —Å–∏—Å—Ç–µ–º–∞–ª–∞—Ä–¥—ã –¥–æ–ª–±–æ–æ—Ä–ª–æ–ø, –∞–ª–∞—Ä–¥—ã –Ω–∞—Ç—ã–π–∂–∞–ª—É—É –∫—ã–ª–∞—Å—ã“£.'
    },
    '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç': {
        'ru': '–¢—ã —Å–æ–∑–¥–∞—ë—à—å –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á.',
        'ky': '–°–µ–Ω –∞—Ä —Ç“Ø—Ä–¥“Ø“Ø –º–∞—Å–µ–ª–µ–ª–µ—Ä “Ø—á“Ø–Ω –ø—Ä–æ–≥—Ä–∞–º–º–∞–ª–∞—Ä–¥—ã –∂–∞–Ω–∞ —Å–∞–Ω–∞—Ä–∏–ø —á–µ—á–∏–º–¥–µ—Ä–¥–∏ —Ç“Ø–∑”©—Å“Ø“£.'
    },
    '–ò–Ω–∂–µ–Ω–µ—Ä –¥–∞–Ω–Ω—ã—Ö': {
        'ru': '–¢—ã —É–º–µ–µ—à—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–∑ –Ω–∏—Ö –ø–æ–ª—å–∑—É.',
        'ky': '–°–µ–Ω —á–æ“£ –∫”©–ª”©–º–¥”©–≥“Ø –º–∞–∞–ª—ã–º–∞—Ç –º–µ–Ω–µ–Ω –∏—à—Ç–µ–ø, –∞–Ω–¥–∞–Ω –ø–∞–π–¥–∞ —á—ã–≥–∞—Ä–∞ –∞–ª–∞—Å—ã“£.'
    },
    '–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫': {
        'ru': '–¢—ã —Å–æ–∑–¥–∞—ë—à—å —É–º–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—à—å –ø—Ä–æ—Ü–µ—Å—Å—ã.',
        'ky': '–°–µ–Ω –∞–∫—ã–ª–¥—É—É –º–∞—à–∏–Ω–∞–ª–∞—Ä–¥—ã —Ç“Ø–∑“Ø–ø, –ø—Ä–æ—Ü–µ—Å—Å—Ç–µ—Ä–¥–∏ –∞–≤—Ç–æ–º–∞—Ç—Ç–∞—à—Ç—ã—Ä–∞—Å—ã“£.'
    },
    '–ò–Ω–∂–µ–Ω–µ—Ä-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä': {
        'ru': '–¢—ã –ø—Ä–∏–¥—É–º—ã–≤–∞–µ—à—å –∏ —Å–æ–±–∏—Ä–∞–µ—à—å –Ω–æ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã.',
        'ky': '–°–µ–Ω –∂–∞“£—ã —Ç“Ø–∑“Ø–ª“Ø—à—Ç”©—Ä–¥“Ø –∂–∞–Ω–∞ –º–µ—Ö–∞–Ω–∏–∑–º–¥–µ—Ä–¥–∏ –æ–π–ª–æ–ø —Ç–∞–±—ã–ø, —á–æ–≥—É–ª—Ç–∞—Å—ã“£.'
    },
    '–≠–ª–µ–∫—Ç—Ä–æ–Ω—â–∏–∫': {
        'ru': '–¢—ã —Ä–∞–∑–±–∏—Ä–∞–µ—à—å—Å—è –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–µ –∏ –ª—é–±–∏—à—å –ø–∞—è—Ç—å –∏ —Å–æ–±–∏—Ä–∞—Ç—å —Å—Ö–µ–º—ã.',
        'ky': '–°–µ–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞–Ω—ã —Ç“Ø—à“Ø–Ω”©—Å“Ø“£ –∂–∞–Ω–∞ —Å—Ö–µ–º–∞–ª–∞—Ä–¥—ã —à–∏—Ä–µ—Ç–∏–ø, —á–æ–≥—É–ª—Ç–∫–∞–Ω–¥—ã –∂–∞–∫—Ç—ã—Ä–∞—Å—ã“£.'
    },
    '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤': {
        'ru': '–¢—ã –¥–µ–ª–∞–µ—à—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —É–¥–æ–±–Ω—ã–º–∏ –∏ –∫—Ä–∞—Å–∏–≤—ã–º–∏.',
        'ky': '–°–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—Ç–µ—Ä–¥–∏ —ã“£–≥–∞–π–ª—É—É –∂–∞–Ω–∞ –∫–æ–æ–∑ –∫—ã–ª–∞—Å—ã“£.'
    },
    '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º': {
        'ru': '–¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å –∑–∞ –ª–æ–≥–∏–∫—É –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏.',
        'ky': '–°–µ–Ω —Å–µ—Ä–≤–µ—Ä –±”©–ª“Ø–≥“Ø–Ω“Ø–Ω –ª–æ–≥–∏–∫–∞—Å—ã –∂–∞–Ω–∞ –∏—à–µ–Ω–∏–º–¥“Ø“Ø–ª“Ø–≥“Ø “Ø—á“Ø–Ω –∂–æ–æ–ø—Ç—É—É—Å—É“£.'
    },
    '–°–∏—Å—Ç–µ–º–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä': {
        'ru': '–¢—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—à—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–æ–≤.',
        'ky': '–°–µ–Ω –¥–æ–ª–±–æ–æ—Ä–ª–æ—Ä–¥—É–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Å—ã–Ω –∂–∞–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Å—ã–Ω –¥–æ–ª–±–æ–æ—Ä–ª–æ–π—Å—É“£.'
    },
    '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π': {
        'ru': '–¢—ã —É–º–µ–µ—à—å –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∏ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ª—é–¥–µ–π.',
        'ky': '–°–µ–Ω –∏—à-—á–∞—Ä–∞–ª–∞—Ä–¥—ã —É—é—à—Ç—É—Ä—É–ø, –∞–¥–∞–º–¥–∞—Ä–¥—ã –±–∏—Ä–∏–∫—Ç–∏—Ä–µ –∞–ª–∞—Å—ã“£.'
    },
    '–§–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä': {
        'ru': '–¢—ã –ø–æ–º–æ–≥–∞–µ—à—å –∫–æ–º–∞–Ω–¥–µ —Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Ü–µ–ª–µ–π.',
        'ky': '–°–µ–Ω –∫–æ–º–∞–Ω–¥–∞–≥–∞ –Ω–∞—Ç—ã–π–∂–∞–ª—É—É –∏—à—Ç–µ–ø, –º–∞–∫—Å–∞—Ç—Ç–∞—Ä–≥–∞ –∂–µ—Ç“Ø“Ø–≥”© –∂–∞—Ä–¥–∞–º –±–µ—Ä–µ—Å–∏“£.'
    },
    'PR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç': {
        'ru': '–¢—ã —É–º–µ–µ—à—å –¥–æ–Ω–æ—Å–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–æ —à–∏—Ä–æ–∫–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏.',
        'ky': '–°–µ–Ω –º–∞–∞–ª—ã–º–∞—Ç—Ç—ã –∫–µ“£–∏—Ä–∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è–≥–∞ –∂–µ—Ç–∫–∏—Ä–µ –∞–ª–∞—Å—ã“£.'
    },
    '–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥': {
        'ru': '–¢—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Ä—ã–Ω–æ–∫ –∏ –ø–æ–º–æ–≥–∞–µ—à—å –ø—Ä–æ–¥–≤–∏–≥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã.',
        'ky': '–°–µ–Ω –±–∞–∑–∞—Ä–¥—ã —Ç–∞–ª–¥–∞–ø, –ø—Ä–æ–¥—É–∫—Ç—É–ª–∞—Ä–¥—ã –∏–ª–≥–µ—Ä–∏–ª–µ—Ç“Ø“Ø–≥”© –∂–∞—Ä–¥–∞–º –±–µ—Ä–µ—Å–∏“£.'
    },
    '–ê–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö': {
        'ru': '–¢—ã –∏—â–µ—à—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç—Ä–æ–∏—à—å –ø—Ä–æ–≥–Ω–æ–∑—ã.',
        'ky': '–°–µ–Ω –º–∞–∞–ª—ã–º–∞—Ç—Ç–∞—Ä–¥–∞–≥—ã –º—ã–π–∑–∞–º —á–µ–Ω–µ–º–¥“Ø“Ø–ª“Ø–∫—Ç”©—Ä–¥“Ø —Ç–∞–∞–ø, –±–æ–ª–∂–æ–ª–¥–æ–æ–ª–æ—Ä–¥—É —Ç“Ø–∑”©—Å“Ø“£.'
    },
    '–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫': {
        'ru': '–¢—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.',
        'ky': '–°–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å—Ç–µ—Ä–¥–∏ —Ç–∞–ª–¥–∞–ø, –æ–ø—Ç–∏–º–∞–ª–¥—É—É —á–µ—á–∏–º–¥–µ—Ä–¥–∏ —Å—É–Ω—É—à—Ç–∞–π—Å—ã“£.'
    },
    '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫': {
        'ru': '–¢—ã —Ä–∞–∑–±–∏—Ä–∞–µ—à—å—Å—è –≤ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö –∏ —É–º–µ–µ—à—å —Å—á–∏—Ç–∞—Ç—å –¥–µ–Ω—å–≥–∏.',
        'ky': '–°–µ–Ω —Ñ–∏–Ω–∞–Ω—Å—ã–Ω—ã —Ç“Ø—à“Ø–Ω“Ø–ø, –∞–∫—á–∞–Ω—ã —ç—Å–µ–ø—Ç–µ–π –∞–ª–∞—Å—ã“£.'
    },
    '–õ–æ–≥–∏–∫': {
        'ru': '–¢—ã –ª—é–±–∏—à—å —Ä–µ—à–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –∏ —Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–ø–æ—á–∫–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π.',
        'ky': '–°–µ–Ω –ª–æ–≥–∏–∫–∞–ª—ã–∫ –º–∞—Å–µ–ª–µ–ª–µ—Ä–¥–∏ —á–µ—á–∏–ø, –æ–π –∂“Ø–≥“Ø—Ä—Ç“Ø“Ø —á—ã–Ω–∂—ã—Ä–ª–∞—Ä—ã–Ω —Ç“Ø–∑–≥”©–Ω–¥“Ø –∂–∞–∫—Ç—ã—Ä–∞—Å—ã“£.'
    },
    '–î–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞': {
        'ru': '–¢—ã —Å–æ–∑–¥–∞—ë—à—å –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.',
        'ky': '–°–µ–Ω –≥–∞—Ä–º–æ–Ω–∏—è–ª—É—É –∂–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã–∫ –º–µ–π–∫–∏–Ω–¥–∏–∫—Ç–µ—Ä–¥–∏ —Ç“Ø–∑”©—Å“Ø“£.'
    },
    '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å—Å–∫–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫': {
        'ru': '–¢—ã –≤—ã—Ä–∞–∂–∞–µ—à—å —Å–µ–±—è —á–µ—Ä–µ–∑ –º—É–∑—ã–∫—É, —Ç–µ–∞—Ç—Ä –∏–ª–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è.',
        'ky': '–°–µ–Ω ”©–∑“Ø“£–¥“Ø –º—É–∑—ã–∫–∞, —Ç–µ–∞—Ç—Ä –∂–µ —á—ã–≥—ã–ø —Å“Ø–π–ª”©”© –∞—Ä–∫—ã–ª—É—É –±–∏–ª–¥–∏—Ä–µ—Å–∏“£.'
    }
}

PROFILE_EMOJIS = {
    '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å': 'üßë‚Äçüî¨',
    '–¢–µ—Ö–Ω–∏–∫': 'ü§ñ',
    '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–∏–π': 'üìö',
    '–¢–≤–æ—Ä–µ—Ü': 'üé®',
    '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π': 'üíº',
    '–ü—Ä–∏–∫–ª–∞–¥–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏': 'üîß',
}

PROFILE_JOBS = {
    '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å': {
        'ru': ['–ù–∞—É—á–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫', '–õ–∞–±–æ—Ä–∞–Ω—Ç', 'Data Scientist'],
        'ky': ['–ò–ª–∏–º–∏–π –∫—ã–∑–º–∞—Ç–∫–µ—Ä', '–õ–∞–±–æ—Ä–∞–Ω—Ç', '–ú–∞–∞–ª—ã–º–∞—Ç –∏–ª–∏–º–ø–æ–∑—É']
    },
    '–ê–Ω–∞–ª–∏—Ç–∏–∫': {
        'ru': ['–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫', '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫', 'Data Analyst'],
        'ky': ['–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫', '–§–∏–Ω–∞–Ω—Å—ã –∞–Ω–∞–ª–∏—Ç–∏–≥–∏', '–ú–∞–∞–ª—ã–º–∞—Ç –∞–Ω–∞–ª–∏—Ç–∏–≥–∏']
    },
    '–¢–≤–æ—Ä–µ—Ü': {
        'ru': ['–î–∏–∑–∞–π–Ω–µ—Ä', '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä', '–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä'],
        'ky': ['–î–∏–∑–∞–π–Ω–µ—Ä', '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä', '–ß—ã–≥–∞—Ä–º–∞—á—ã–ª –¥–∏—Ä–µ–∫—Ç–æ—Ä']
    },
    '–¢–µ—Ö–Ω–∞—Ä—å': {
        'ru': ['–ò–Ω–∂–µ–Ω–µ—Ä', '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', '–¢–µ—Ö–Ω–∏–∫'],
        'ky': ['–ò–Ω–∂–µ–Ω–µ—Ä', '–ò—à—Ç–µ–ø —á—ã–≥—É—É—á—É', '–¢–µ—Ö–Ω–∏–∫']
    },
    '–ö–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä': {
        'ru': ['PR-–º–µ–Ω–µ–¥–∂–µ—Ä', '–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç', '–£—á–∏—Ç–µ–ª—å'],
        'ky': ['PR-–º–µ–Ω–µ–¥–∂–µ—Ä', '–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç', '–ú—É–≥–∞–ª–∏–º']
    },
    '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä': {
        'ru': ['–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤', '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'Event-–º–µ–Ω–µ–¥–∂–µ—Ä'],
        'ky': ['–î–æ–ª–±–æ–æ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∏', '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', '–ò—à-—á–∞—Ä–∞ —É—é—à—Ç—É—Ä—É—É—á—É']
    },
    '–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ö—É–¥–æ–∂–Ω–∏–∫': {
        'ru': ['–•—É–¥–æ–∂–Ω–∏–∫', '–ò–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä', '–î–µ–∫–æ—Ä–∞—Ç–æ—Ä'],
        'ky': ['–°“Ø—Ä”©—Ç—á“Ø', '–ò–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä', '–î–µ–∫–æ—Ä–∞—Ç–æ—Ä']
    },
    '–¶–∏—Ñ—Ä–æ–≤–æ–π —Ö—É–¥–æ–∂–Ω–∏–∫': {
        'ru': ['–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω–µ—Ä', '3D-–∞–Ω–∏–º–∞—Ç–æ—Ä', 'UI/UX –¥–∏–∑–∞–π–Ω–µ—Ä'],
        'ky': ['–ì—Ä–∞—Ñ–∏–∫–∞–ª—ã–∫ –¥–∏–∑–∞–π–Ω–µ—Ä', '3D-–∞–Ω–∏–º–∞—Ç–æ—Ä', 'UI/UX –¥–∏–∑–∞–π–Ω–µ—Ä']
    },
    '–ü–∏—Å–∞—Ç–µ–ª—å': {
        'ru': ['–ö–æ–ø–∏—Ä–∞–π—Ç–µ—Ä', '–†–µ–¥–∞–∫—Ç–æ—Ä', '–°—Ü–µ–Ω–∞—Ä–∏—Å—Ç'],
        'ky': ['–ö–æ–ø–∏—Ä–∞–π—Ç–µ—Ä', '–†–µ–¥–∞–∫—Ç–æ—Ä', '–°—Ü–µ–Ω–∞—Ä–∏—Å—Ç']
    },
    '–≠–∫–æ–ª–æ–≥': {
        'ru': ['–≠–∫–æ–ª–æ–≥', '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —É—Å—Ç–æ–π—á–∏–≤–æ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é'],
        'ky': ['–≠–∫–æ–ª–æ–≥', '–¢—É—Ä—É–∫—Ç—É—É ”©–Ω“Ø–≥“Ø“Ø –±–æ—é–Ω—á–∞ –∞–¥–∏—Å']
    },
    '–£—á–µ–Ω—ã–π-–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫': {
        'ru': ['–ë–∏–æ–ª–æ–≥', '–§–∏–∑–∏–∫', '–•–∏–º–∏–∫'],
        'ky': ['–ë–∏–æ–ª–æ–≥', '–§–∏–∑–∏–∫', '–•–∏–º–∏–∫']
    },
    '–°–æ—Ü–∏–æ–ª–æ–≥': {
        'ru': ['–°–æ—Ü–∏–æ–ª–æ–≥', '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–Ω–µ–Ω–∏—è'],
        'ky': ['–°–æ—Ü–∏–æ–ª–æ–≥', '–ö–æ–æ–º–¥—É–∫ –ø–∏–∫–∏—Ä–¥–∏ –∏–∑–∏–ª–¥”©”©—á“Ø']
    },
    '–ò—Å—Ç–æ—Ä–∏–∫': {
        'ru': ['–ò—Å—Ç–æ—Ä–∏–∫', '–ê—Ä—Ö–∏–≤–∏—Å—Ç'],
        'ky': ['–¢–∞—Ä—ã—Ö—á—ã', '–ê—Ä—Ö–∏–≤—á–∏']
    },
    '–ü—Å–∏—Ö–æ–ª–æ–≥': {
        'ru': ['–ü—Å–∏—Ö–æ–ª–æ–≥', '–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç'],
        'ky': ['–ü—Å–∏—Ö–æ–ª–æ–≥', '–ö–µ“£–µ—à—á–∏']
    },
    '–ò–Ω–∂–µ–Ω–µ—Ä-—Å–∏—Å—Ç–µ–º–æ—Ç–µ—Ö–Ω–∏–∫': {
        'ru': ['–°–∏—Å—Ç–µ–º–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä', '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Å–∏—Å—Ç–µ–º'],
        'ky': ['–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∂–µ–Ω–µ—Ä–∏', '–°–∏—Å—Ç–µ–º–∞–ª–∞—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É']
    },
    '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç': {
        'ru': ['–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ü–û', 'Web-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫'],
        'ky': ['–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∏—à—Ç–µ–ø —á—ã–≥—É—É—á—É', '–í–µ–±-–∏—à—Ç–µ–ø —á—ã–≥—É—É—á—É']
    },
    '–ò–Ω–∂–µ–Ω–µ—Ä –¥–∞–Ω–Ω—ã—Ö': {
        'ru': ['Data Engineer', '–ê–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö'],
        'ky': ['–ú–∞–∞–ª—ã–º–∞—Ç –∏–Ω–∂–µ–Ω–µ—Ä–∏', '–ú–∞–∞–ª—ã–º–∞—Ç –∞–Ω–∞–ª–∏—Ç–∏–≥–∏']
    },
    '–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫': {
        'ru': ['–ò–Ω–∂–µ–Ω–µ—Ä-—Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫', '–ú–µ—Ö–∞—Ç—Ä–æ–Ω–∏–∫'],
        'ky': ['–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫ –∏–Ω–∂–µ–Ω–µ—Ä', '–ú–µ—Ö–∞—Ç—Ä–æ–Ω–∏–∫']
    },
    '–ò–Ω–∂–µ–Ω–µ—Ä-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä': {
        'ru': ['–ò–Ω–∂–µ–Ω–µ—Ä-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', '–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫'],
        'ky': ['–ò–Ω–∂–µ–Ω–µ—Ä-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', '–î–æ–ª–±–æ–æ—Ä–ª–æ–æ—á—É']
    },
    '–≠–ª–µ–∫—Ç—Ä–æ–Ω—â–∏–∫': {
        'ru': ['–ò–Ω–∂–µ–Ω–µ—Ä-—ç–ª–µ–∫—Ç—Ä–æ–Ω—â–∏–∫', '–°—Ö–µ–º–æ—Ç–µ—Ö–Ω–∏–∫'],
        'ky': ['–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏–Ω–∂–µ–Ω–µ—Ä–∏', '–°—Ö–µ–º–∞ —Ç–µ—Ö–Ω–∏–≥–∏']
    },
    '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤': {
        'ru': ['Frontend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', 'UI-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫'],
        'ky': ['Frontend-–∏—à—Ç–µ–ø —á—ã–≥—É—É—á—É', 'UI-–∏—à—Ç–µ–ø —á—ã–≥—É—É—á—É']
    },
    '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º': {
        'ru': ['Backend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', 'DevOps-–∏–Ω–∂–µ–Ω–µ—Ä'],
        'ky': ['Backend-–∏—à—Ç–µ–ø —á—ã–≥—É—É—á—É', 'DevOps-–∏–Ω–∂–µ–Ω–µ—Ä']
    },
    '–°–∏—Å—Ç–µ–º–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä': {
        'ru': ['–°–∏—Å—Ç–µ–º–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä', 'DevOps-–∏–Ω–∂–µ–Ω–µ—Ä'],
        'ky': ['–°–∏—Å—Ç–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É', 'DevOps-–∏–Ω–∂–µ–Ω–µ—Ä']
    },
    '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π': {
        'ru': ['Event-–º–µ–Ω–µ–¥–∂–µ—Ä', '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤'],
        'ky': ['–ò—à-—á–∞—Ä–∞ —É—é—à—Ç—É—Ä—É—É—á—É', '–î–æ–ª–±–æ–æ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É']
    },
    '–§–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä': {
        'ru': ['–§–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä', '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä'],
        'ky': ['–§–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä', '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä']
    },
    'PR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç': {
        'ru': ['PR-–º–µ–Ω–µ–¥–∂–µ—Ä', '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è–º'],
        'ky': ['PR-–º–µ–Ω–µ–¥–∂–µ—Ä', '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –±–æ—é–Ω—á–∞ –∞–¥–∏—Å']
    },
    '–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥': {
        'ru': ['–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥', '–ë—Ä–µ–Ω–¥-–º–µ–Ω–µ–¥–∂–µ—Ä'],
        'ky': ['–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥', '–ë—Ä–µ–Ω–¥-–º–µ–Ω–µ–¥–∂–µ—Ä']
    },
    '–ê–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö': {
        'ru': ['Data Analyst', 'BI-–∞–Ω–∞–ª–∏—Ç–∏–∫'],
        'ky': ['–ú–∞–∞–ª—ã–º–∞—Ç –∞–Ω–∞–ª–∏—Ç–∏–≥–∏', 'BI-–∞–Ω–∞–ª–∏—Ç–∏–∫']
    },
    '–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫': {
        'ru': ['–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫', '–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫'],
        'ky': ['–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–≥–∏', '–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫']
    },
    '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫': {
        'ru': ['–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫', '–≠–∫–æ–Ω–æ–º–∏—Å—Ç'],
        'ky': ['–§–∏–Ω–∞–Ω—Å—ã –∞–Ω–∞–ª–∏—Ç–∏–≥–∏', '–≠–∫–æ–Ω–æ–º–∏—Å—Ç']
    },
    '–õ–æ–≥–∏–∫': {
        'ru': ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫', '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤'],
        'ky': ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫', '–ê–ª–≥–æ—Ä–∏—Ç–º –∏—à—Ç–µ–ø —á—ã–≥—É—É—á—É']
    },
    '–î–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞': {
        'ru': ['–î–∏–∑–∞–π–Ω–µ—Ä –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞', '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä'],
        'ky': ['–ò–Ω—Ç–µ—Ä—å–µ—Ä –¥–∏–∑–∞–π–Ω–µ—Ä–∏', '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä']
    },
    '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å—Å–∫–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫': {
        'ru': ['–ê–∫—Ç—ë—Ä', '–ú—É–∑—ã–∫–∞–Ω—Ç', '–í–µ–¥—É—â–∏–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π'],
        'ky': ['–ê–∫—Ç—ë—Ä', '–ú—É–∑—ã–∫–∞–Ω—Ç', '–ò—à-—á–∞—Ä–∞ –∞–ª—ã–ø –±–∞—Ä—É—É—á—É']
    }
}

RECOMMENDATION = {
    'ru': '‚ú® SkillPath —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç: –†–∞–∑–≤–∏–≤–∞–π —Å–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏ –ø—Ä–æ–±—É–π —Å–µ–±—è –≤ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö. –ú–∏—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è, –∏ —Ç–≤–æ–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω—ã –≤ —Å–∞–º—ã—Ö —Ä–∞–∑–Ω—ã—Ö —Å—Ñ–µ—Ä–∞—Ö!',
    'ky': '‚ú® SkillPath –∫–µ“£–µ—à –±–µ—Ä–µ—Ç: –ö“Ø—á—Ç“Ø“Ø –∂–∞–∫—Ç–∞—Ä—ã“£–¥—ã ”©–Ω“Ø–∫—Ç“Ø—Ä –∂–∞–Ω–∞ –∞—Ä –∫–∞–Ω–¥–∞–π –±–∞–≥—ã—Ç—Ç–∞—Ä–¥–∞ ”©–∑“Ø“£–¥“Ø —Å—ã–Ω–∞. –ö–µ—Å–∏–ø—Ç–µ—Ä –¥“Ø–π–Ω”©—Å“Ø –¥–∞–π—ã–º–∞ ”©–∑–≥”©—Ä”©—Ç, —Å–µ–Ω–∏–Ω —É–Ω–∏–∫–∞–ª–¥—É—É —Å–∞–ø–∞—Ç—Ç–∞—Ä—ã“£ –∞—Ä —Ç“Ø—Ä–¥“Ø“Ø —Ç–∞—Ä–º–∞–∫—Ç–∞—Ä–¥–∞ –∫–µ—Ä–µ–∫ –±–æ–ª—É—à—É –º“Ø–º–∫“Ø–Ω!'
}

# --- –°–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫—ã—Ä–≥—ã–∑—Å–∫–∏—Ö –∏ —Ä—É—Å—Å–∫–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π ---
KY_TO_RU_PROFILE = {
    '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è',
    '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è',
    '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω–∞—è': '–ñ–∞—Ä–∞—Ç—ã–ª—ã—à —Ç–∞–∞–Ω—É—É',
    '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è': '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è',
    '–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è': '–ß—ã–≥–∞—Ä–º–∞—á—ã–ª-–∫”©—Ä–∫”©–º',
    '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è': '–ö–æ–ª–¥–æ–Ω–º–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã–∫',
}

# --- –°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ ---
PROFILE_TRANSLATIONS = {
    "ru": {},
    "ky": {
        "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è": "–¢–µ—Ö–Ω–∏–∫–∞–ª—ã–∫",
        "–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è": "–ì—É–º–∞–Ω–∏—Ç–∞—Ä–¥—ã–∫",
        "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω–∞—è": "–ñ–∞—Ä–∞—Ç—ã–ª—ã—à —Ç–∞–∞–Ω—É—É",
        "–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è": "–°–æ—Ü–∏–∞–ª–¥—ã–∫-—ç–∫–æ–Ω–æ–º–∏–∫–∞–ª—ã–∫",
        "–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è": "–ß—ã–≥–∞—Ä–º–∞—á—ã–ª-–∫”©—Ä–∫”©–º",
        "–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è": "–ö–æ–ª–¥–æ–Ω–º–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã–∫",
    }
}

@router.message(Command("test"))
async def start_test(message: Message, state: FSMContext):
    user_data = await UserManager.get_user(message.from_user.id)
    if not user_data or not user_data.get("fio"):
        lang = await get_user_lang(message.from_user.id)
        await message.answer(get_message("register", lang))
        await state.clear()
        await state.set_state(RegistrationStates.waiting_for_fio)
        await message.answer(get_message("registration_fio", lang))
        return
    # --- –ü–†–û–í–ï–†–ö–ê –ü–†–û–ì–†–ï–°–°–ê ---
    progress = await TestProgressManager.get_progress(message.from_user.id)
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤–∞–ª–∏–¥–Ω—ã–π: –Ω–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω—ã –∏ –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω
    valid_progress = False
    if progress and progress.get("all_scenes") and progress.get("scene_index", 0) < len(progress["all_scenes"]):
        all_scenes = progress["all_scenes"]
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∏–º–µ–Ω–Ω–æ –±–∞–∑–æ–≤—ã–µ —Å—Ü–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ id –ø–µ—Ä–≤–æ–π —Å—Ü–µ–Ω—ã)
        if all_scenes and all_scenes[0].get("id", 0) == 1:
            valid_progress = True
    if valid_progress:
        await state.update_data(**progress)
        all_scenes = progress["all_scenes"]
        scene_index = progress["scene_index"]
        from handlers.test import send_scene
        await send_scene(message, all_scenes[scene_index], state=state)
        return
    # –ï—Å–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî –æ—á–∏—â–∞–µ–º –∏ —Å—Ç–∞—Ä—Ç—É–µ–º –∑–∞–Ω–æ–≤–æ
    await TestProgressManager.delete_progress(message.from_user.id)
    from handlers.test_utils import start_test_flow
    await start_test_flow(message, state)

@router.message(F.text.in_(["üß© –¢–µ—Å—Ç", "üß© –¢–µ—Å—Ç"]))
async def start_test_button(message: Message, state: FSMContext):
    await start_test(message, state)

import random

CREATIVE_TEXTS = {
    'ru': [
    "‚ú® –¢—ã —Å–¥–µ–ª–∞–ª –≤—ã–±–æ—Ä! –ü—É—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...",
    "üöÄ –ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî —ç—Ç–æ –Ω–æ–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ!",
    "üåü –û—Ç–ª–∏—á–Ω–æ! –î–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ!",
    "üîÆ –¢–≤–æ–π –≤—ã–±–æ—Ä —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –±—É–¥—É—â–µ–µ!",
    "üî• –í–ø–µ—Ä—ë–¥ –∫ –Ω–æ–≤—ã–º –æ—Ç–∫—Ä—ã—Ç–∏—è–º!",
    ],
    'ky': [
        "‚ú® –°–µ–Ω —Ç–∞–Ω–¥–æ–æ –∂–∞—Å–∞–¥—ã“£! –ñ–æ–ª —É–ª–∞–Ω—Ç—ã–ª—É—É–¥–∞...",
        "üöÄ –ê—Ä –±–∏—Ä –∫–∞–¥–∞–º ‚Äî –∂–∞“£—ã –∞—á—ã–ª—ã—à!",
        "üåü –ú—ã–∫—Ç—ã! –ê–ª–¥—ã–≥–∞ –∂—ã–ª–∞–±—ã–∑!",
        "üîÆ –°–µ–Ω–∏–Ω —Ç–∞–Ω–¥–æ–æ“£ –∫–µ–ª–µ—á–µ–∫—Ç–∏ —Ç“Ø–∑“Ø–ø –∂–∞—Ç–∞—Ç!",
        "üî• –ñ–∞“£—ã –∞—á—ã–ª—ã—à—Ç–∞—Ä–≥–∞ –∫–∞—Ä–∞–π –∞–ª–¥—ã–≥–∞!",
    ]
}

def genderize(text, gender):
    if not text:
        return ""
    # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ {gender:male|–º—É–∂|–∂–µ–Ω} –¥–ª—è –ª—é–±–æ–≥–æ —è–∑—ã–∫–∞ (–≤ —Ç–æ–º —á–∏—Å–ª–µ –∫—ã—Ä–≥—ã–∑—Å–∫–æ–≥–æ)
    def replacer(match):
        male, female = match.group(1), match.group(2)
        return female if gender == 'female' else male
    return re.sub(r'\{gender:male\|([^|]+)\|([^}]+)\}', replacer, text)

def get_scene_text(scene, scene_index=None, total_scenes=None, creative_prefix=None, gender='male'):
    title = genderize(scene.get('title', ''), gender)
    desc = genderize(scene.get('description', '') or scene.get('text', ''), gender)
    progress = ""
    if scene_index is not None and total_scenes is not None:
        bar_len = 8
        filled = int((scene_index+1) / total_scenes * bar_len)
        progress_bar = f"{'üü©'*filled}{'‚¨úÔ∏è'*(bar_len-filled)} {scene_index+1}/{total_scenes}"
        progress = f"<b>–í–æ–ø—Ä–æ—Å {scene_index+1} –∏–∑ {total_scenes}</b>\n{progress_bar}\n"
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
    options = scene.get('options', [])
    options_text = ""
    if options:
        options_text = "\n".join([
            f"<b>{i+1}.</b> {genderize(opt['text'], gender)}" for i, opt in enumerate(options)
        ])
    if title and desc:
        return f"{progress}<b>{title}</b>\n\n{desc}\n\n{options_text}"
    elif title:
        return f"{progress}<b>{title}</b>\n\n{options_text}"
    elif desc:
        return f"{progress}{desc}\n\n{options_text}"
    else:
        return f"{progress}–í–æ–ø—Ä–æ—Å\n\n{options_text}"

async def send_scene(message_or_callback, scene, scene_type='main', state=None, creative_prefix=None, only_option_id=None, extra_buttons=None):
    scene_index = None
    total_scenes = None
    gender = 'male'
    if state is not None:
        data = await state.get_data()
        all_scenes = data.get('all_scenes', [])
        for idx, s in enumerate(all_scenes):
            if s['id'] == scene['id']:
                scene_index = idx
                break
        total_scenes = len(all_scenes)
        gender = data.get('gender', 'male')
    text = get_scene_text(scene, scene_index, total_scenes, gender=gender)
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text=f"{i+1}. {genderize(opt['text'], gender)}", callback_data=f"{scene_type}:{scene['id']}:{opt['id']}")]
            for i, opt in enumerate(scene.get('options', []))
                if not only_option_id or str(opt['id']) == str(only_option_id)
            ] + (extra_buttons if extra_buttons else [])
    )
    if isinstance(message_or_callback, CallbackQuery):
        await message_or_callback.message.edit_text(text, reply_markup=keyboard, parse_mode="HTML")
    else:
        await message_or_callback.answer(text, reply_markup=keyboard, parse_mode="HTML")

@router.callback_query(F.data.regexp(r'^(main|personal):'))
async def handle_scene_callback(callback: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    all_scenes = data.get('all_scenes', [])
    if not all_scenes:
        lang = data.get('lang', 'ru')
        await callback.message.answer(
            "–ü–æ—Ö–æ–∂–µ, —Ç–µ—Å—Ç –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –∏–ª–∏ –≤—ã —Å–º–µ–Ω–∏–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ/—è–∑—ã–∫. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ –∫–æ–º–∞–Ω–¥–æ–π /test."
            if lang == 'ru' else
            "–ö—ã—è–∑—ã, —Ç–µ—Å—Ç “Ø–∑–≥“Ø–ª—Ç“Ø–∫–∫”© —É—á—É—Ä–∞–¥—ã –∂–µ —Å–∏–∑ —Ç“Ø–∑–º”©–∫/—Ç–∏–ª–¥–∏ –∞–ª–º–∞—à—Ç—ã—Ä–¥—ã“£—ã–∑. –°—É—Ä–∞–Ω—ã—á, —Ç–µ—Å—Ç—Ç–∏ –∫–∞–π—Ä–∞–¥–∞–Ω /test –±—É–π—Ä—É–≥—É –º–µ–Ω–µ–Ω –±–∞—à—Ç–∞“£—ã–∑."
        )
        await state.clear()
        return
    scene_index = data.get('scene_index', 0)
    profile_scores = data.get('profile_scores', {})
    profession_scores = data.get('profession_scores', {})
    lang = data.get('lang', 'ru')
    gender = data.get('gender', 'male')
    scene_type, scene_id, option_id = callback.data.split(":", 2)
    scene_id = int(scene_id)
    scene = next((s for s in all_scenes if s['id'] == scene_id), None)
    if not scene:
        await callback.message.answer("–û—à–∏–±–∫–∞: —Å—Ü–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞." if lang == 'ru' else "–ö–∞—Ç–∞: —Å—Ü–µ–Ω–∞ —Ç–∞–±—ã–ª–≥–∞–Ω –∂–æ–∫.")
        return
    selected_option = next((opt for opt in scene.get('options', []) if str(opt['id']) == option_id), None)
    if not selected_option:
        await callback.message.answer("–û—à–∏–±–∫–∞: –æ–ø—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞." if lang == 'ru' else "–ö–∞—Ç–∞: –æ–ø—Ü–∏—è —Ç–∞–±—ã–ª–≥–∞–Ω –∂–æ–∫.")
        return
    
    # --- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º feedback —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ alert ---
    feedback_text = selected_option.get('feedback')
    def genderize(text):
        if gender == 'female':
            return text.replace('{gender:male|—Å—è|–∞—Å—å}', '–∞—Å—å').replace('{gender:male||–∞}', '–∞').replace('{gender:male||–Ω–∞}', '–Ω–∞')
        else:
            return text.replace('{gender:male|—Å—è|–∞—Å—å}', '—Å—è').replace('{gender:male||–∞}', '').replace('{gender:male||–Ω–∞}', '')
    feedback_text = genderize(feedback_text) if feedback_text else ''
    if feedback_text:
        await callback.answer(feedback_text, show_alert=True)
    
    # --- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø–æ –ø—Ä–æ—Ñ–∏–ª—è–º (–ø–µ—Ä–≤—ã–µ 6 —Å—Ü–µ–Ω) ---
    if scene_type == 'main' and 'profile' in selected_option:
        profiles = selected_option['profile']
        if isinstance(profiles, list):
            for profile in profiles:
                name = profile.get('name') if isinstance(profile, dict) else profile
                profile_scores[name] = profile_scores.get(name, 0) + 1
        else:
            name = profiles.get('name') if isinstance(profiles, dict) else profiles
            profile_scores[name] = profile_scores.get(name, 0) + 1
    
    # --- –ü–æ—Å–ª–µ 6-–π —Å—Ü–µ–Ω—ã —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω—ã ---
    if scene_type == 'main' and scene_index == 5:
        if profile_scores:
            top_profile = max(profile_scores.items(), key=lambda x: x[1])[0]
        else:
            top_profile = None
        PROFILE_TO_PROFILE_NAME = {
            '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è',
            '–¢–µ—Ö–Ω–∏–∫–∞–ª—ã–∫': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è',
            '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è',
            '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–¥—ã–∫': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è',
            '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω–∞—è': '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω–∞—è',
            '–¢–∞–±–∏–≥—ã–π-–∏–ª–∏–º–∏–π': '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω–∞—è',
            '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è': '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è',
            '–°–æ—Ü–∏–∞–ª–¥—ã–∫-—ç–∫–æ–Ω–æ–º–∏–∫–∞–ª—ã–∫': '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è',
            '–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è': '–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è',
            '–ß—ã–≥–∞—Ä–º–∞—á—ã–ª-–∫”©—Ä–∫”©–º': '–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è',
            '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è': '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è',
            '–ö–æ–ª–¥–æ–Ω–º–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã–∫': '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã–∫',
        }
        profile_name = PROFILE_TO_PROFILE_NAME.get(top_profile)
        sm = SceneManager(language=lang, gender=gender)
        personal_scenes = sm.get_personal_scenes_by_branch(profile_name)
        if not personal_scenes:
            await callback.message.answer("–ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π." if lang == 'ru' else "–ë—É–ª –ø—Ä–æ—Ñ–∏–ª—å “Ø—á“Ø–Ω –∂–µ–∫–µ —Å—Ü–µ–Ω–∞–ª–∞—Ä –∂–æ–∫. –ë–∞—à–∫–∞ –ø—Ä–æ—Ñ–∏–ª–¥–∏ —Ç–∞–Ω–¥–∞–ø –∫”©—Ä“Ø“£“Ø–∑.")
            return
        await state.update_data(
            all_scenes=personal_scenes,
            scene_index=0,
            branch=profile_name,
            profile_scores=profile_scores,
            profession_scores=profession_scores
        )
        await send_scene(callback, personal_scenes[0], scene_type='personal', state=state)
        return
    
    # --- –í –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ö —Å—á–∏—Ç–∞–µ–º –±–∞–ª–ª—ã –ø–æ –≤—Å–µ–º profiles (–ø–æ name) ---
    if scene_type == 'personal' and 'profiles' in selected_option:
        for prof in selected_option['profiles']:
            prof_name = prof.get('name')
            if prof_name:
                profession_scores[prof_name] = profession_scores.get(prof_name, 0) + prof.get('weight', 1)
    
    # --- –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å ‚Äî –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç ---
    if scene_type == 'personal' and scene_index+1 >= len(all_scenes):
        print(f"[DEBUG] –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω: scene_index={scene_index}, len(all_scenes)={len(all_scenes)}")
        await show_test_result(callback, state)
        return
    
    # --- –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ ---
    if scene_index+1 < len(all_scenes):
        await state.update_data(scene_index=scene_index+1, profile_scores=profile_scores, profession_scores=profession_scores)
        next_scene = all_scenes[scene_index+1]
        await send_scene(callback, next_scene, scene_type=scene_type, state=state)
        # --- –°–û–•–†–ê–ù–Ø–ï–ú –ü–†–û–ì–†–ï–°–° ---
        await TestProgressManager.save_progress(
            callback.from_user.id,
            scene_index+1,
            all_scenes,
            profile_scores,
            profession_scores,
            lang
        )
    else:
        # –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –≤—ã—à–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –º–∞—Å—Å–∏–≤–∞, —è–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º show_test_result
        print(f"[DEBUG] –ò–Ω–¥–µ–∫—Å –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: scene_index={scene_index}, len(all_scenes)={len(all_scenes)}")
        await show_test_result(callback, state)

async def show_test_result(message_or_callback, state: FSMContext, all_collected=False):
    data = await state.get_data()
    profile_scores = data.get('profile_scores', {})
    profession_scores = data.get('profession_scores', {})
    user_id = message_or_callback.from_user.id if hasattr(message_or_callback, 'from_user') else message_or_callback.message.from_user.id
    lang = data.get('lang', 'ru')
    artifact_lang = lang
    
    # --- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ---
    details_keys = {
        'ru': {
            'profile_scores': '–ü—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ –±–∞–ª–ª—ã',
            'profession_scores': '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã',
            'artifact': '–ê—Ä—Ç–µ—Ñ–∞–∫—Ç',
            'lang': '–Ø–∑—ã–∫',
        },
        'ky': {
            'profile_scores': '–ü—Ä–æ—Ñ–∏–ª—å–¥–∏–∫ —É–ø–∞–π–ª–∞—Ä',
            'profession_scores': '–ö–µ—Å–∏–ø—Ç–∏–∫ —É–ø–∞–π–ª–∞—Ä',
            'artifact': '–ê—Ä—Ç–µ—Ñ–∞–∫—Ç',
            'lang': '–¢–∏–ª',
        }
    }[artifact_lang]
    
    # --- –í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ñ—Ä–∞–∑—ã ---
    result_titles = {
        'ru': "<b>üéâ –¢–≤–æ–π –ø—É—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!</b>",
        'ky': "<b>üéâ –°–µ–Ω–∏–Ω –∂–æ–ª—É“£ —ç–º–∏ –±–∞—à—Ç–∞–ª–¥—ã!</b>"
    }
    artifact_phrases = {
        'ru': "üèÜ –¢—ã –ø–æ–ª—É—á–∏–ª —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç! –≠—Ç–æ —Ç–≤–æ–π —Å–∏–º–≤–æ–ª –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ –Ω–æ–≤—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∏–π:",
        'ky': "üèÜ –°–µ–Ω —É–Ω–∏–∫–∞–ª–¥—É—É –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∞–ª–¥—ã“£! –ë—É–ª —Å–µ–Ω–∏–Ω –∂–µ—Ç–∏—à–∫–µ–Ω–¥–∏–∫—Ç–µ—Ä–∏“£–¥–∏–Ω –∂–∞–Ω–∞ –∂–∞“£—ã –∞—á—ã–ª—ã—à—Ç–∞—Ä—ã“£–¥—ã–Ω –±–µ–ª–≥–∏—Å–∏:"
    }
    all_collected_phrases = {
        'ru': "üéä –¢—ã —Å–æ–±—Ä–∞–ª –≤—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è! –¢—ã ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å!",
        'ky': "üéä –ë—É–ª –ø—Ä–æ—Ñ–∏–ª–¥–∏–Ω –±–∞—Ä–¥—ã–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—Ç–∞—Ä—ã–Ω —á–æ–≥—É–ª—Ç—Ç—É“£! –°–µ–Ω —á—ã–Ω—ã–≥—ã –∏–∑–∏–ª–¥”©”©—á“Ø—Å“Ø“£!"
    }
    no_profession_phrases = {
        'ru': "ü§î –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏—é. –ü–æ–ø—Ä–æ–±—É–π –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –¥—Ä—É–≥–æ–π –ø—É—Ç—å!",
        'ky': "ü§î –ö–µ—Å–∏–ø –∞–Ω—ã–∫—Ç–∞–ª–≥–∞–Ω –∂–æ–∫. –¢–µ—Å—Ç—Ç–∏ –∫–∞–π—Ä–∞ ”©—Ç“Ø–ø –∫”©—Ä –∂–µ –±–∞—à–∫–∞ –∂–æ–ª–¥—É —Ç–∞–Ω–¥–∞!"
    }
    top_professions_title = {
        'ru': "<b>üîù –¢–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã (–¢–û–ü-3 –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏):</b>",
        'ky': "<b>üîù –°–µ–Ω–∏–Ω –∫“Ø—á—Ç“Ø“Ø –∂–∞–∫—Ç–∞—Ä—ã“£ (–¢–û–ü-3 –∫–µ—Å–∏–ø):</b>"
    }
    top_profiles_title = {
        'ru': "<b>üåà –¢–≤–æ–∏ –≤–µ–¥—É—â–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏:</b>",
        'ky': "<b>üåà –°–µ–Ω–∏–Ω –Ω–µ–≥–∏–∑–≥–∏ –ø—Ä–æ—Ñ–∏–ª–¥–µ—Ä–∏“£:</b>"
    }
    details_title = {
        'ru': "<b>üìä –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:</b>",
        'ky': "<b>üìä –ù–∞—Ç—ã–π–∂–∞–Ω—ã–Ω –¥–µ—Ç–∞–ª–¥–∞—Ä—ã:</b>"
    }
    retry_text = {
        'ru': "üîÑ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ",
        'ky': "üîÑ –¢–µ—Å—Ç—Ç–∏ –∫–∞–π—Ä–∞ ”©—Ç“Ø“Ø"
    }
    
    # --- –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç ---
    prof_keys = set(ARTIFACTS_BY_PROFESSION.keys())
    prof_scores = {k: v for k, v in profession_scores.items() if k in prof_keys}
    
    # --- –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–ø-1 –ø—Ä–æ—Ñ–µ—Å—Å–∏—é (–∏–ª–∏ —Å–ª—É—á–∞–π–Ω–æ –∏–∑ —Ç–æ–ø–æ–≤—ã—Ö) ---
    top_profession = None
    max_score = 0
    if prof_scores:
        max_score = max(prof_scores.values())
        top_professions = [k for k, v in prof_scores.items() if v == max_score]
        top_profession = random.choice(top_professions)
    
    # --- –ü–æ–ª—É—á–∞–µ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ —è–∑—ã–∫—É ---
    artifact = None
    if top_profession in ARTIFACTS_BY_PROFESSION:
        artifact = ARTIFACTS_BY_PROFESSION[top_profession].get(artifact_lang) or ARTIFACTS_BY_PROFESSION[top_profession].get('ru')
    
    # --- –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
    user = await UserManager.get_user(user_id)
    user_artifacts = user.artifacts if user else []
    
    # --- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —ç—Ç–æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç ---
    artifact_key = artifact['name'] if artifact else None
    new_artifact = artifact_key and artifact_key not in user_artifacts
    
    # --- –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç, –µ—Å–ª–∏ –Ω–æ–≤—ã–π ---
    if artifact_key:
        try:
            if new_artifact:
                user_artifacts.append(artifact_key)
                user.artifacts = json.dumps(user_artifacts, ensure_ascii=False)
                allowed_fields = {
                    "telegram_id", "fio", "school", "class_number", "class_letter",
                    "gender", "birth_year", "city", "language", "artifacts", "opened_profiles"
                }
                user_data = {k: v for k, v in user.__dict__ if k in allowed_fields}
                if isinstance(user_data.get('opened_profiles'), list):
                    user_data['opened_profiles'] = json.dumps(user_data['opened_profiles'], ensure_ascii=False)
                if user_data.get('language') not in ['ru', 'ky']:
                    user_data['language'] = normalize_lang(user_data.get('language', 'ru'))
                await UserManager.update_user(user_id, **user_data)
            if new_artifact:
                await message_or_callback.answer(f"üéâ –¢—ã –ø–æ–ª—É—á–∏–ª –Ω–æ–≤—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: <b>{artifact_key}</b>!" if lang == 'ru' else f"üéâ –°–µ–Ω –∂–∞“£—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∞–ª–¥—ã“£: <b>{artifact_key}</b>!", parse_mode="HTML")
        except Exception as e:
            print(f"[ERROR] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: {e}")
            await message_or_callback.answer("‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ." if lang == 'ru' else "‚ö†Ô∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–∞–∫—Ç–æ–æ–¥–æ –∫–∞—Ç–∞ –∫–µ—Ç—Ç–∏. –ö–∏–π–∏–Ω—á–µ—Ä—ç—ç–∫ –∞—Ä–∞–∫–µ—Ç –∫—ã–ª—ã–ø –∫”©—Ä“Ø“£“Ø–∑.")
    else:
        await message_or_callback.answer("‚ùóÔ∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π –ø—É—Ç—å." if lang == 'ru' else "‚ùóÔ∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç –∞–Ω—ã–∫—Ç–∞–ª–≥–∞–Ω –∂–æ–∫. –¢–µ—Å—Ç—Ç–∏ –∫–∞–π—Ä–∞ ”©—Ç“Ø–ø –∫”©—Ä“Ø“£“Ø–∑ –∂–µ –±–∞—à–∫–∞ –∂–æ–ª–¥—É —Ç–∞–Ω–¥–∞“£—ã–∑.")
    
    # --- –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≤ opened_profiles ---
    if top_profession:
        opened_profiles = set(user.opened_profiles or [])
        opened_profiles.add(top_profession)
        user.opened_profiles = list(opened_profiles)
        await UserManager.update_user(user_id, opened_profiles=user.opened_profiles)
    
    # --- –ö–†–ê–°–ò–í–û–ï –û–§–û–†–ú–õ–ï–ù–ò–ï ---
    lines = []
    lines.append(result_titles[artifact_lang])
    lines.append("<b>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</b>")
    
    if all_collected:
        lines.append(all_collected_phrases[artifact_lang])
    elif artifact:
        lines.append(artifact_phrases[artifact_lang] + f"\n<b>{artifact['name']}</b> ‚Äî <i>{artifact['desc']}</i>")
    else:
        lines.append(no_profession_phrases[artifact_lang])
    
    lines.append("<b>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</b>")
    
    # --- –¢–æ–ø-3 –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ---
    if not profession_scores:
        lines.append(no_profession_phrases[artifact_lang])
    else:
        top_professions = sorted(profession_scores.items(), key=lambda x: x[1], reverse=True)[:3]
        lines.append(top_professions_title[artifact_lang])
        for name, score in top_professions:
            display_name = PROFILE_TRANSLATIONS[artifact_lang].get(name, name)
            lines.append(f"<b>‚Ä¢ {display_name}</b> ‚Äî <b>{score} ‚≠ê</b>")
    
    # --- –¢–æ–ø-3 –ø—Ä–æ—Ñ–∏–ª—è (–¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏) ---
    if profile_scores:
        top_profiles = sorted(profile_scores.items(), key=lambda x: x[1], reverse=True)[:3]
        lines.append(top_profiles_title[artifact_lang])
        for name, score in top_profiles:
            display_name = PROFILE_TRANSLATIONS[artifact_lang].get(name, name)
            lines.append(f"<b>‚Ä¢ {display_name}</b> ‚Äî <b>{score} ‚≠ê</b>")
        top_profile = top_profiles[0][0] if top_profiles else "-"
    else:
        top_profile = "-"
    
    lines.append("<b>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</b>")
    
    # --- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (profile_scores, profession_scores, artifact, lang) ---
    details_lines = []
    details_lines.append(f"<b>‚Ä¢ {details_keys['profile_scores']}:</b> <code>{profile_scores}</code>")
    details_lines.append(f"<b>‚Ä¢ {details_keys['profession_scores']}:</b> <code>{profession_scores}</code>")
    details_lines.append(f"<b>‚Ä¢ {details_keys['artifact']}:</b> <code>{artifact_key if artifact_key else '-'}</code>")
    details_lines.append(f"<b>‚Ä¢ {details_keys['lang']}:</b> <code>{artifact_lang}</code>")
    lines.append(details_title[artifact_lang] + '\n' + '\n'.join(details_lines))
    
    text = "\n".join(lines)
    
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text=retry_text[artifact_lang], callback_data="restart_test")]
        ]
    )
    
    # –†–∞–∑–±–∏–≤–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —á–∞—Å—Ç–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    MAX_LEN = 4000
    if isinstance(message_or_callback, Message):
        for i in range(0, len(text), MAX_LEN):
            await message_or_callback.answer(text[i:i+MAX_LEN], reply_markup=keyboard if i == 0 else None, parse_mode="HTML")
    else:
        try:
            for i in range(0, len(text), MAX_LEN):
                await message_or_callback.message.edit_text(text[i:i+MAX_LEN], reply_markup=keyboard if i == 0 else None, parse_mode="HTML")
        except Exception as e:
            if "message is not modified" in str(e):
                pass  # –ü—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —ç—Ç—É –æ—à–∏–±–∫—É
            else:
                raise
    
    await state.clear()

    # --- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –≤ API (TestResult) ---
    try:
        test_result = {
            "telegram_id": user_id,
            "finished_at": datetime.now().isoformat(),
            "profile": top_profession or "-",
            "score": max_score if prof_scores else 0,
            "details": json.dumps({
                "profile_scores": profile_scores,
                "profession_scores": profession_scores,
                "artifact": artifact_key,
                "lang": artifact_lang
            }, ensure_ascii=False)
        }
        await TestResultsManager.add_test_result(test_result)
    except Exception as e:
        print(f"[ERROR] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞: {e}")

    # --- –£–î–ê–õ–Ø–ï–ú –ü–†–û–ì–†–ï–°–° ---
    await TestProgressManager.delete_progress(user_id)

@router.callback_query(F.data == "restart_test")
async def restart_test_callback(callback: CallbackQuery, state: FSMContext):
    await start_test(callback.message, state)

@router.callback_query(F.data == "to_start")
async def to_start_callback(callback: CallbackQuery, state: FSMContext):
    # –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞
    await start_test_flow(callback.message, state)

@router.callback_query(F.data.regexp(r'^(personal):'))
async def handle_personal_scene_callback(callback: CallbackQuery, state: FSMContext):
    await handle_scene_callback(callback, state)

# --- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º ---
# –ß–∞—Å—Ç—å PROFESSION_TIPS –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞

@router.message(F.text.in_(["üóùÔ∏è –ö–æ–ª–ª–µ–∫—Ü–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤", "üóùÔ∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—Ç–∞—Ä –∫–æ–ª–ª–µ–∫—Ü–∏—è—Å—ã"]))
async def show_artifact_collection(message: Message):
    user_id = message.from_user.id
    user = await UserManager.get_user(user_id)
    user_artifacts = set(user.artifacts or [])
    lang = await get_user_lang(user_id)
    artifact_lang = lang
    branch_names = {
        'ru': {
            'technical': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π',
            'natural_science': '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω—ã–π',
            'humanitarian': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π',
            'social_economic': '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π',
            'creative_art': '–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π',
            'applied_technology': '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π',
        },
        'ky': {
            'technical': '–¢–µ—Ö–Ω–∏–∫–∞–ª—ã–∫',
            'natural_science': '–ñ–∞—Ä–∞—Ç—ã–ª—ã—à —Ç–∞–∞–Ω—É—É',
            'humanitarian': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–¥—ã–∫',
            'social_economic': '–°–æ—Ü–∏–∞–ª–¥—ã–∫-—ç–∫–æ–Ω–æ–º–∏–∫–∞–ª—ã–∫',
            'creative_art': '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ–ª—É–∫-–∫”©—Ä–∫”©–º',
            'applied_technology': '–ö–æ–ª–¥–æ–Ω–º–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã–∫',
        }
    }[artifact_lang]
    kb = InlineKeyboardBuilder()
    for branch, name in branch_names.items():
        kb.button(text=name, callback_data=f"artifact_branch:{branch}")
    kb.adjust(2)
    await message.answer(
        "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤:" if artifact_lang == 'ru' else "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—Ç–∞—Ä–¥—ã –∫”©—Ä“Ø“Ø “Ø—á“Ø–Ω –ø—Ä–æ—Ñ–∏–ª–¥–∏ —Ç–∞–Ω–¥–∞“£—ã–∑:",
        reply_markup=kb.as_markup()
    )

@router.callback_query(F.data.regexp(r'^artifact_branch:'))
async def show_artifacts_by_branch(callback: CallbackQuery):
    user_id = callback.from_user.id
    user = await UserManager.get_user(user_id)
    user_artifacts = set(user.artifacts or [])
    lang = await get_user_lang(user_id)
    artifact_lang = lang
    branch = callback.data.split(':', 1)[1]
    branch_names = {
        'ru': {
            'technical': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π',
            'natural_science': '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω—ã–π',
            'humanitarian': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π',
            'social_economic': '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π',
            'creative_art': '–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π',
            'applied_technology': '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π',
        },
        'ky': {
            'technical': '–¢–µ—Ö–Ω–∏–∫–∞–ª—ã–∫',
            'natural_science': '–ñ–∞—Ä–∞—Ç—ã–ª—ã—à —Ç–∞–∞–Ω—É—É',
            'humanitarian': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–¥—ã–∫',
            'social_economic': '–°–æ—Ü–∏–∞–ª–¥—ã–∫-—ç–∫–æ–Ω–æ–º–∏–∫–∞–ª—ã–∫',
            'creative_art': '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ–ª—É–∫-–∫”©—Ä–∫”©–º',
            'applied_technology': '–ö–æ–ª–¥–æ–Ω–º–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã–∫',
        }
    }[artifact_lang]
    arts = [art for art in ARTIFACTS_BY_PROFESSION.values() if art.get('branch') == branch][:10]
    total = len(arts)
    collected = sum(1 for art in arts if art.get(artifact_lang, {}).get('name', '') in user_artifacts)
    bar_len = 10
    filled = int(bar_len * collected / total) if total else 0
    progress_bar = f"{'üü©'*filled}{'‚¨úÔ∏è'*(bar_len-filled)} {collected}/{total}"
    # --- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ ---
    status_received = {"ru": "–ø–æ–ª—É—á–µ–Ω!", "ky": "–∞–ª—ã–Ω–¥—ã!"}
    status_not_received = {"ru": "–µ—â—ë –Ω–µ –ø–æ–ª—É—á–µ–Ω", "ky": "–∞–∑—ã—Ä—ã–Ω—á–∞ –∞–ª—ã–Ω–∞ —ç–ª–µ–∫"}
    lines = [f"<b>üóùÔ∏è {branch_names[branch]} –ø—Ä–æ—Ñ–∏–ª—å:</b>" if artifact_lang == 'ru' else f"<b>üóùÔ∏è {branch_names[branch]} –ø—Ä–æ—Ñ–∏–ª–∏:</b>", progress_bar]
    all_collected = True
    for art in arts:
        if artifact_lang in art:
            art_name = art[artifact_lang]['name']
            emoji = art[artifact_lang].get('emoji', 'üóùÔ∏è')
            desc = art[artifact_lang]['desc']
        else:
            art_name = art['ru']['name']
            emoji = art['ru'].get('emoji', 'üóùÔ∏è')
            desc = art['ru']['desc']
        if art_name in user_artifacts:
            lines.append(f"{emoji} <b>{art_name}</b> ‚Äî <i>{status_received[artifact_lang]}</i>\n{desc}")
        else:
            lines.append(f"{emoji} <b>{art_name}</b> ‚Äî <i>{status_not_received[artifact_lang]}</i>")
            all_collected = False
    if all_collected and arts:
        lines.append("\nüéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã —Å–æ–±—Ä–∞–ª –≤—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è!</b>" if artifact_lang=='ru' else "\nüéâ <b>–ö—É—Ç—Ç—É–∫—Ç–∞–π–±—ã–∑! –ë—É–ª –ø—Ä–æ—Ñ–∏–ª–¥–∏–Ω –±–∞—Ä–¥—ã–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—Ç–∞—Ä—ã–Ω —á–æ–≥—É–ª—Ç—Ç—É“£!</b>")
    back_kb = InlineKeyboardMarkup(
        inline_keyboard=[[InlineKeyboardButton(text="–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ñ–∏–ª—å" if artifact_lang == 'ru' else "–ë–∞—à–∫–∞ –ø—Ä–æ—Ñ–∏–ª—å —Ç–∞–Ω–¥–æ–æ", callback_data="artifact_choose_profile")]]
    )
    await callback.message.edit_text("\n\n".join(lines), parse_mode="HTML", reply_markup=back_kb)
    await callback.answer()

@router.callback_query(F.data == "artifact_choose_profile")
async def artifact_choose_profile(callback: CallbackQuery):
    lang = await get_user_lang(callback.from_user.id)
    artifact_lang = lang
    
    branch_names = {
        'ru': {
            'technical': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π',
            'natural_science': '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω—ã–π',
            'humanitarian': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π',
            'social_economic': '–°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π',
            'creative_art': '–¢–≤–æ—Ä—á–µ—Å–∫–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π',
            'applied_technology': '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π',
        },
        'ky': {
            'technical': '–¢–µ—Ö–Ω–∏–∫–∞–ª—ã–∫',
            'natural_science': '–ñ–∞—Ä–∞—Ç—ã–ª—ã—à —Ç–∞–∞–Ω—É—É',
            'humanitarian': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–¥—ã–∫',
            'social_economic': '–°–æ—Ü–∏–∞–ª–¥—ã–∫-—ç–∫–æ–Ω–æ–º–∏–∫–∞–ª—ã–∫',
            'creative_art': '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ–ª—É–∫-–∫”©—Ä–∫”©–º',
            'applied_technology': '–ö–æ–ª–¥–æ–Ω–º–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã–∫',
        }
    }[artifact_lang]
    
    kb = InlineKeyboardBuilder()
    for branch, name in branch_names.items():
        kb.button(text=name, callback_data=f"artifact_branch:{branch}")
    kb.adjust(2)
    
    await callback.message.edit_text(
        "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤:" if artifact_lang == 'ru' else "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—Ç–∞—Ä–¥—ã –∫”©—Ä“Ø“Ø “Ø—á“Ø–Ω –ø—Ä–æ—Ñ–∏–ª–¥–∏ —Ç–∞–Ω–¥–∞“£—ã–∑:",
        reply_markup=kb.as_markup()
    )
    await callback.answer()

# --- –ü–æ—Ä—Ç–∞–ª—ã: –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª—è–º ---
@router.message(F.text.in_(["üóùÔ∏è –ü–æ—Ä—Ç–∞–ª—ã", "üóùÔ∏è –ü–æ—Ä—Ç–∞–ª–¥–∞—Ä"]))
async def show_portals(message: Message):
    user_id = message.from_user.id
    user = await UserManager.get_user(user_id)
    opened_profiles = user.opened_profiles or []
    # --- –ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è: –∑–∞–º–µ–Ω—è–µ–º –∫—ã—Ä–≥—ã–∑—Å–∫–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–µ ---
    corrected_profiles = []
    changed = False
    for prof in opened_profiles:
        if prof in KY_TO_RU_PROFILE:
            corrected_profiles.append(KY_TO_RU_PROFILE[prof])
            changed = True
        else:
            corrected_profiles.append(prof)
    if changed:
        user.opened_profiles = corrected_profiles
        await UserManager.update_user(user_id, opened_profiles=user.opened_profiles)
        print(f"[DEBUG] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã opened_profiles: {corrected_profiles}")
    opened_profiles = corrected_profiles
    lang = await get_user_lang(user_id)
    artifact_lang = lang
    if not opened_profiles:
        await message.answer("–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–∞–ª–æ–≤." if artifact_lang == 'ru' else "–°–µ–Ω–¥–µ –∞–∑—ã—Ä—ã–Ω—á–∞ –∞—á—ã–∫ –ø–æ—Ä—Ç–∞–ª–¥–∞—Ä –∂–æ–∫.")
        return
    kb = InlineKeyboardBuilder()
    for prof in opened_profiles:
        # –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –≤—ã–≤–æ–¥–∞ –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ
        display_name = PROFILE_TRANSLATIONS[artifact_lang].get(prof, prof)
        kb.button(text=display_name, callback_data=f"portal:{prof}")
    kb.adjust(2)
    await message.answer(
        "–í—ã–±–µ—Ä–∏ –ø–æ—Ä—Ç–∞–ª –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:" if artifact_lang == 'ru' else "–¢–µ–∑ ”©—Ç“Ø“Ø “Ø—á“Ø–Ω –ø–æ—Ä—Ç–∞–ª–¥—ã —Ç–∞–Ω–¥–∞“£—ã–∑:",
        reply_markup=kb.as_markup()
    )

@router.callback_query(F.data.regexp(r'^portal:'))
async def start_personal_portal(callback: CallbackQuery, state: FSMContext):
    profile_name = callback.data.split(":", 1)[1]
    # --- –ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è: –µ—Å–ª–∏ –≤–¥—Ä—É–≥ profile_name –Ω–∞ –∫—ã—Ä–≥—ã–∑—Å–∫–æ–º, –ø–µ—Ä–µ–≤–æ–¥–∏–º –Ω–∞ —Ä—É—Å—Å–∫–∏–π ---
    if profile_name in KY_TO_RU_PROFILE:
        profile_name = KY_TO_RU_PROFILE[profile_name]
        print(f"[DEBUG] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω profile_name –Ω–∞ —Ä—É—Å—Å–∫–∏–π: {profile_name}")
    lang = await get_user_lang(callback.from_user.id)
    artifact_lang = lang
    gender = 'male'  # –ú–æ–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–∞ –∏–∑ user_data
    sm = SceneManager(language=lang, gender=gender)
    personal_scenes = sm.get_personal_scenes_by_branch(profile_name)
    if not personal_scenes:
        await callback.message.answer("–ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è." if artifact_lang == 'ru' else "–ë—É–ª –ø—Ä–æ—Ñ–∏–ª—å “Ø—á“Ø–Ω –∂–µ–∫–µ —Å—Ü–µ–Ω–∞–ª–∞—Ä –∂–æ–∫.")
        return
    await state.clear()
    await state.update_data(
        all_scenes=personal_scenes,
        scene_index=0,
        branch=profile_name,
        profile_scores={},
        profession_scores={}
    )
    # --- –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ñ–∏–ª—å (–≤—Å–µ–≥–¥–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º) ---
    user = await UserManager.get_user(callback.from_user.id)
    opened_profiles = set(user.opened_profiles or [])
    # --- –ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ---
    corrected_profiles = set()
    for prof in opened_profiles:
        if prof in KY_TO_RU_PROFILE:
            corrected_profiles.add(KY_TO_RU_PROFILE[prof])
        else:
            corrected_profiles.add(prof)
    corrected_profiles.add(profile_name)
    user.opened_profiles = list(corrected_profiles)
    await UserManager.update_user(callback.from_user.id, opened_profiles=user.opened_profiles)
    await send_scene(callback, personal_scenes[0], scene_type='personal', state=state)
    await callback.answer()

def register_handlers(dispatcher):
    dispatcher.include_router(router)